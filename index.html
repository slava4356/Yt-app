<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>YouTube Центр</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <script>
        // ==========================================
        // 1. ВСТАВЬ СВОЙ ID МЕЖДУ КАВЫЧЕК НИЖЕ:
        const GOOGLE_CLIENT_ID = "275783825400-cp763gk82kdde9v0gf891pqt7hp2qfq9.apps.googleusercontent.com"; 
        // ==========================================

        let MY_API_KEY = localStorage.getItem('slava_key') || '';

        window.onload = function() {
            // Настройка кнопки Google
            const gDiv = document.getElementById('g_id_onload');
            if(gDiv) gDiv.setAttribute('data-client_id', GOOGLE_CLIENT_ID);
            
            if (MY_API_KEY) startApplication();
        };

        function saveKeyAndGo() {
            const val = document.getElementById('apiInput').value.trim();
            if (val) {
                MY_API_KEY = val;
                localStorage.setItem('slava_key', val);
                startApplication();
            } else {
                alert("Пожалуйста, введите ключ API!");
            }
        }

        function onGoogleSignIn(response) {
            const user = JSON.parse(atob(response.credential.split('.')[1]));
            localStorage.setItem('slava_user', JSON.stringify(user));
            if (MY_API_KEY) startApplication();
            else alert("Вход выполнен! Теперь введите API Ключ в поле.");
        }

        function startApplication() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            loadTrending();
        }

        async function loadTrending() {
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=RU&maxResults=15&key=${MY_API_KEY}`);
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);
                drawVideos(data.items);
            } catch (err) {
                alert("Ошибка ключа! Проверьте, включен ли YouTube Data API v3 в Google Console.");
            }
        }

        async function searchVideos() {
            const q = document.getElementById('sq').value;
            if(!q) return;
            const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&type=video&maxResults=15&key=${MY_API_KEY}`);
            const data = await res.json();
            drawVideos(data.items);
        }

        function drawVideos(items) {
            const feed = document.getElementById('video-feed');
            feed.innerHTML = '';
            items.forEach(item => {
                const id = item.id.videoId || item.id;
                const s = item.snippet;
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <img src="${s.thumbnails.high.url}" onclick="window.open('https://youtube.com/watch?v=${id}')">
                    <div class="video-info">
                        <div class="video-title">${s.title}</div>
                        <div style="color:#aaa; font-size:12px;">${s.channelTitle}</div>
                        <button class="btn-download" onclick="window.open('https://cobalt.tools')">СКАЧАТЬ ВИДЕО</button>
                    </div>
                `;
                feed.appendChild(card);
            });
        }

        function exitApp() {
            localStorage.clear();
            location.reload();
        }
    </script>

    <style>
        :root { --red: #ff0000; --bg: #000; --surface: #1a1a1a; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; }
        #login-page { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center; }
        .logo { font-size: 42px; font-weight: 900; color: var(--red); margin-bottom: 20px; }
        .input-key { width: 100%; max-width: 320px; background: var(--surface); border: 1px solid #333; color: white; padding: 15px; border-radius: 12px; margin-bottom: 12px; text-align: center; }
        .btn-enter { width: 100%; max-width: 320px; background: var(--red); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; }
        #main-app { display: none; }
        .nav { position: sticky; top: 0; background: rgba(0,0,0,0.9); padding: 12px; display: flex; gap: 10px; z-index: 100; border-bottom: 1px solid #222; }
        .search-bar { flex: 1; background: var(--surface); border: none; border-radius: 20px; padding: 10px 15px; color: white; outline: none; }
        .video-card { margin-bottom: 20px; }
        .video-card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .video-info { padding: 15px; }
        .video-title { font-size: 15px; font-weight: bold; margin-bottom: 8px; }
        .btn-download { background: #fff; color: #000; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="login-page">
        <div class="logo">YT CENTER</div>
        <p style="color: #888;">Вставьте ваш YouTube API Ключ</p>
        <input type="password" id="apiInput" class="input-key" placeholder="AIzaSy...">
        <button class="btn-enter" onclick="saveKeyAndGo()">ОТКРЫТЬ ОБЛАКО</button>
        <div style="margin: 30px 0; color: #444;">ИЛИ ВОЙТИ ЧЕРЕЗ GOOGLE</div>
        <div id="g_id_onload" data-callback="onGoogleSignIn"></div>
        <div class="g_id_signin" data-type="standard"></div>
    </div>

    <div id="main-app">
        <div class="nav">
            <input type="text" id="sq" class="search-bar" placeholder="Найти видео..." onkeypress="if(event.key==='Enter') searchVideos()">
            <button onclick="exitApp()" style="background:none; border:none; color:red; font-size:24px;">✕</button>
        </div>
        <div id="video-feed"></div>
    </div>

</body>
</html>
