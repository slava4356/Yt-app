<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>YouTube Центр</title>
    <meta name="theme-color" content="#000000">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --accent: #ff0000;
            --bg: #000000;
            --surface: #121212;
        }
        body {
            margin: 0;
            background: var(--bg);
            color: #fff;
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        /* Вход */
        .login-screen {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        .logo {
            font-size: 42px;
            font-weight: 900;
            color: var(--accent);
            margin-bottom: 10px;
        }
        /* Приложение */
        #app { display: none; }
        .nav {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.9);
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            border-bottom: 1px solid #222;
        }
        .nav img { width: 32px; height: 32px; border-radius: 50%; }
        .search-box {
            flex: 1;
            background: #222;
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
        }
        .search-box input {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            font-size: 16px;
        }
        /* Лента */
        .feed { padding: 5px; }
        .v-card { margin-bottom: 20px; cursor: pointer; }
        .v-card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 12px; }
        .v-info { padding: 10px; }
        .v-title { font-size: 15px; font-weight: 500; line-height: 1.3; }
        .v-meta { color: #aaa; font-size: 12px; margin-top: 5px; }
        .btn-dl {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!-- Экран логина -->
    <div id="login" class="login-screen">
        <div class="logo">YouTube Центр</div>
        <p style="color: #888;">Ваши рекомендации и легкая загрузка</p>
        <div id="g_btn" style="margin-top: 30px;"></div>
        
        <div style="margin-top: 40px; width: 100%; max-width: 280px;">
            <input type="password" id="keyField" placeholder="Введите API Key" 
                   style="width:100%; padding:12px; background:#1a1a1a; border:1px solid #333; color:white; border-radius:10px; text-align:center;">
            <button onclick="saveKey()" style="width:100%; margin-top:10px; padding:12px; background:#333; color:white; border:none; border-radius:10px;">Сохранить ключ</button>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="app">
        <div class="nav">
            <img id="u-avatar" src="">
            <div class="search-box">
                <input type="text" id="q" placeholder="Поиск..." onkeypress="if(event.key==='Enter') search()">
            </div>
            <button onclick="logout()" style="background:none; border:none; color:red; font-size:20px;">✕</button>
        </div>
        <div id="feed" class="feed"></div>
    </div>

    <script>
        // ДАННЫЕ ИЗ GOOGLE CLOUD
        const CLIENT_ID = "963462479979-6c3oir9keu0g35g92sm4gjmmktpgoc62.apps.googleusercontent.com"; 
        let API_KEY = localStorage.getItem('yt_cloud_key') || '';

        window.onload = function() {
            google.accounts.id.initialize({ client_id: CLIENT_ID, callback: onAuth });
            google.accounts.id.renderButton(document.getElementById("g_btn"), { theme: "filled_black", size: "large", shape: "pill" });
            
            const savedUser = localStorage.getItem('yt_user');
            if(savedUser && API_KEY) showApp(JSON.parse(savedUser));
        };

        function onAuth(resp) {
            const user = JSON.parse(atob(resp.credential.split('.')[1]));
            localStorage.setItem('yt_user', JSON.stringify(user));
            if(API_KEY) showApp(user);
            else alert("Теперь сохрани API Key ниже!");
        }

        function saveKey() {
            const val = document.getElementById('keyField').value.trim();
            if(val) { API_KEY = val; localStorage.setItem('yt_cloud_key', val); location.reload(); }
        }

        function showApp(user) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('u-avatar').src = user.picture;
            loadTrending();
        }

        async function loadTrending() {
            const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=RU&maxResults=15&key=${API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            render(data.items);
        }

        async function search() {
            const query = document.getElementById('q').value;
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=15&key=${API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            render(data.items);
        }

        function render(items) {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            items.forEach(v => {
                const id = v.id.videoId || v.id;
                const s = v.snippet;
                const div = document.createElement('div');
                div.className = 'v-card';
                div.innerHTML = `
                    <img src="${s.thumbnails.high.url}" onclick="window.open('https://youtube.com/watch?v=${id}')">
                    <div class="v-info">
                        <div class="v-title">${s.title}</div>
                        <div class="v-meta">${s.channelTitle}</div>
                        <button class="btn-dl" onclick="window.open('https://cobalt.tools')">СКАЧАТЬ</button>
                    </div>
                `;
                feed.appendChild(div);
            });
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }
    </script>
</body>
</html>

